#!/bin/sh
NAME=ctable
LOCAL=`kpsewhich --expand-var '$TEXMFLOCAL'`/tex/latex
echo y |tex $NAME.ins >/dev/null
(
  # recompile example graphics if any is missing:
  cd doc
  ln -sf ../ctable.sty || exit 1 # use the ctable.sty version to be installed
  for i in [0-9][0-9]?; do 
    if [ ! -f $i.pdf -o ! -f s$i.pdf ]; then
      echo Creating example graphics
      ./doit || exit 1
      ./doit -c
      break
    fi
  done
  rm ctable.sty
  cd ..
  
  echo Creating documentation
  pdflatex --interaction=batchmode $NAME.dtx  || exit 1
  if [ -f $NAME.glo ]; then
    makeindex -q -s gglo.ist -o $NAME.gls $NAME.glo || exit 1
  fi
  if [ -f $NAME.idx ]; then
    makeindex -q -s gind.ist -o $NAME.ind $NAME.idx || exit 1
  fi
  pdflatex --interaction=batchmode $NAME.dtx > /dev/null || exit 1
  
  # set environment variable NOINSTALL to skip installation in your textree
  if [ "$NOINSTALL" = "" ]; then
    echo Installing $NAME.{dtx,sty,pdf}
    sudo cp $NAME.dtx $LOCAL || exit 1
    sudo mv -f $NAME.sty $NAME.pdf $LOCAL || exit 1
  fi
  echo cleanup
  rm -f $NAME.{aux,idx,ilg,ind,log,glo,gls,out} #doc/*.pdf 
  sudo mktexlsr || exit 1
)
if [ $? != 0 ]; then 
  echo errors detected
else
  echo ctable successfully installed
fi

# $Id$

